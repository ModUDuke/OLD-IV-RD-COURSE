--- 
title       : "Introduction to Instrumental Variables"
description : "This chapter will introduce you to instrumental variables (IV) analysis"


--- type:VideoExercise lang:r aspect_ratio:62.5 xp:50 skills:1 key:9c7273586e
## The Logic of Instrumental Variables
*** =video_link
//player.vimeo.com/video/219558904

--- type:VideoExercise lang:r aspect_ratio:62.5 xp:50 skills:1 key:8a1c462927
## Visual Logic of Instrumental Variables
*** =video_link
//player.vimeo.com/video/219559011

--- type:MultipleChoiceExercise lang:r xp:50 skills:1 key:8c410956e7
## What is the Relationship Between the Instrument and the Outcome?
As the videos discussed, there are some strict requirements to use instrumental variables analysis, so we will review the relationship between the instrument and the outcome. Which one of these is the correct assumption for IV analysis?

  *** =instructions
- The instrument has a direct causal effect on the outcome, but is only correlated with the treatment.
- The instrument has a direct causal effect on the treatment, but is only correlated with the outcome.
- The instrument has no direct causal effect on either the treatment or the outcome.
- The instrument has a direct causal effect on both the treatment and the outcome.
*** =sct
```{r}
msg1 = "That's not correct. The instrument should only be correlated with the outcome, and must have a causal effect on the treatment variable. Try again."
msg2 = "Correct! Nice job."
msg3 = "The instrument must have a causal effect on the treatment (but not on the outcome) to use an instrumental variables analysis. Try again."
msg4 = "The instrument should have a causal effect on the treatment, but should only be correlated wit the outcome. Try again."
test_mc(correct = 2, feedback_msgs = c(msg1,msg2,msg3,msg4))
```

--- type:MultipleChoiceExercise lang:r xp:50 skills:1 key:4c7896c749
## What is the Relationship Between the Instrument and the Treatment?
Now let us review the relationship between the instrument and the treatment.  Which one of these is the correct assumption for IV analysis?

  *** =instructions
- The instrument is not correlated with the treatment.
- The treatment has a causal effect on the instrument.
- The treatment and the outcome have a causal effect on the instrument.
- The instrument has a causal effect on the treatment.
*** =sct
```{r}
msg1 = "Incorrect. Not only does the instrument need to be correlated with the treatment, it must have a causal effect on the treatment. Try again."
msg2 = "That is backwards. The instrument needs to have a causal effect on the treatment, so try again."
msg3 = "This doesn't make much sense: we're trying to find the effect of the treatment on the outcome! Try again"
msg4 = "Correct!"
test_mc(correct = 4, feedback_msgs = c(msg1,msg2,msg3,msg4))
```

--- type:MultipleChoiceExercise lang:r xp:50 skills:1 key:8a1ad925e4
## What is the Relationship Between the Instrument and the Other Pre-Treatment Variables?
The instrument is one of many variables that could be confounding the effect of what we really want to study: the effect of our treatment on the outcome. Let us review the relationship of the instrument to this larger pool of potential confounders. Which of the following statements is correct for an IV analysis?

  *** =instructions
- The instrument must be correlated with all measured pre-treatment variables.
- The pre-treatment variables have a causal effect on the instrument.
- We do not need to worry about unobserved pre-treatment variables, they are by definition not correlated with the instrument.
- The instrument is uncorrelated with the other pre-treatment variables.

*** =sct
```{r}
msg1 = "This is very incorrect. It should have no correlation to any other pre-treatment variables, a.k.a. is randomly assigned. Try again."
msg2 = "Incorrect. The other pre-treatment variables should have no correlation with the instrument. Try again."
msg3 = "This is not true. Just because we don't have data on a variable does not mean it might not affect the instrument. Try again"
msg4 = "Correct!"
test_mc(correct = 4, feedback_msgs = c(msg1,msg2,msg3,msg4))
```

--- type:MultipleChoiceExercise lang:r xp:50 skills:1 key:ed73a92806
## How Do We Calculate a Causal Effect with Instrumental Variables Analysis?
So now we can summarize the main purpose of IV analysis. Once again, how does the instrumental variable help us understand the causal effect of the treatment on the outcome?

  *** =instructions
- The treatment affects the instrument, which affects the outcome. The causal effect of the treatment on the outcome is equal to the correlation of the instrument and the treatment.
- The treatment affects the outcome, and the instrument is correlated with the outcome. To get the effect of the treatment on the outcome, we calculate the correlation of the instrument on the outcome.
- The instrument affects the treatment, and the treatment affects the outcome. To get the effect of the treatment on the outcome, we find the correlation of the instrument on the outcome, and subtract out the effect of the instrument on the treatment.
- The instrument and the treatment combine to create the outcome. So the treatment effect is the sum of the effect of the instrument on the treatment and the effect of the treatment on the outcome.

*** =sct
```{r}
msg1 = "This is not the design of IV analysis. We need to subtract out the effect of the instrument on the treatment from the correlation of the instrument on the outcome. Try again."
msg2 = "Incorrect. We need to subtract out the effect of the instrument on the treatment from the correlation of the instrument on the outcome. Try again."
msg3 = "Correct! Way to go!"
msg4 = "That is not exactly the process. We do not add these effects together to find the causal effect. Try again."
test_mc(correct = 3, feedback_msgs = c(msg1,msg2,msg3,msg4))
```

--- type:MultipleChoiceExercise lang:r xp:50 skills:1 key:e48c3917d8
## What if Our Data Shows No Clear Correlation Between Treatment and Outcome?
Suppose we run an Instrumental Variable analysis, and in our initial data exploration, we find that the treatment is uncorrelated with the outcome. But nonetheless, we carry on with the IV analysis and find that it shows a positive causal effect of the treatment on the outcome. How should we interpret these results?

  *** =instructions
- One of the IV assumptions must be violated, thus the IV estimate is wrong.
- There could be a causal effect, but it must be small.
- There must be a large amount of measurement error in either the treatment or the instrument.
- None of the above.

*** =sct
```{r}
msg1 = "If you look back at the required assumptions for IV, the correlation between treatment and the outcome is not mentioned, so try again."
msg2 = "The causal effect we calculated could be big or small, and it would not change the question we are facing. Try again."
msg3 = "The amount of measurement error might be worth watching, but it isn't listed as an element in the requirements for IV analysis. Try again."
msg4 = "Correct! This question is a little tricky. If you look back at the list of logical requirements for an IV analysis, the amount or sign of correlation between treatments and outcomes is not listed, and it turns out to be completely irrelevant for instrumental variables analysis. That is because the correlation between treatment and outcome would be meaningul if treatment was randomly assigned, but we are considering the case where treatments are *not* randomly assigned, so we know that correlation (or the lack thereof) does not imply causation (or the lack thereof). For instrumental variables analysis, all the assumptions are about how the instrument itself relates to the other variables."
test_mc(correct = 4, feedback_msgs = c(msg1,msg2,msg3,msg4))

```

--- type:VideoExercise lang:r aspect_ratio:62.5 xp:50 skills:1 key:953b93e528
## Instrumental Variables in Action: Education and Wages (graphs)
*** =video_link
//player.vimeo.com/video/219559159


--- type:VideoExercise lang:r aspect_ratio:62.5 xp:50 skills:1 key:116a9fd6fa
## Instrumental Variables in Action: Education and Wages (tables)
*** =video_link
//player.vimeo.com/video/219559305

--- type:MultipleChoiceExercise lang:r xp:50 skills:1 key:5ad3dddd73
## Is it Endogenous vs Exogenous Variation? 
Suppose you are interested in the economic status of new college graduates, and have just gotten access to geographic data on where people live and work after they graduate from college. In your first step of data analysis, you subset this geographic data to categorize both their home and work locations as either urban or rural, giving you a binary treatment variable. Let's say that you then compare what kinds of places (rural vs. urban) where people live versus the kinds of places where they work. What kind of variation would that variable have?

*** =instructions
- Exogenous
- Endogenous
- Both

*** =sct
```{r}
msg1 = "Where people choose to live and work are usually affected by at least some shared factors, which means it's not all external forces impacting these--unless they are in the military or in prison! Try again"
msg2 = "Correct! People who work in urban areas probably live in urban areas, and people that work in rural areas probably live in rural areas, so these choices are being influenced by shared factors, which means they have endogenous variation. The most common exceptions to this would be things like military service (or a prison sentence!)."
msg3 = "While there might be external reasons that affect people's choice of where to live in ways they cannot change, usually it's the case that people ultimately make the decision on where they want to live. Try again"
test_mc(correct = 2, feedback_msgs = c(msg1,msg2,msg3))
```

--- type:MultipleChoiceExercise lang:r xp:50 skills:1 key:e4ac42d0db
## An Example of Instrumental Variable Analysis
Alan the almond farmer consistently sells all of his almond crops. Since Alan is the only almond farmer in his county, Alan has no direct competition. Due to his great sales and lack of competition, Alan is considering raising the prices of his almonds. However, Alan is worried that increasing the prices of his almonds might hurt his sales and overall margins.

Alan wants to know whether almond sales are particularly sensitive to prices. Alan has data on what portion of almonds were sold across each county of his state for the past 10 years and he knows how much they were sold for, but he's not sure whether he could use these variables to identify a true causal relationship. Alan comes up with an idea for doing an instrumental variable analysis: Alan knows that farmers consistently increase their almond prices on years when they have low almond yields, and Alan knows that the number of almonds tends to be low on years when there is little rain. Therefore, Alan believes that he could study weather patterns as an instrument for prices. If weather effects the amount of almonds, and the amount of almonds affects sales, can studying the association between weather and almond sales help Alan determine whether there is a causal relationship between almond prices and almond sales?


*** =instructions
- Yes
- No
*** =sct
```{r}
msg1 = "Correct! The instrument has an indirect causal effect on almond sales through almond sales prices. This is a good example of where instrumental variable analysis would work."
msg2 = "Try again"
test_mc(correct = 1, feedback_msgs = c(msg1,msg2))
```


--- type:MultipleChoiceExercise lang:r xp:50 skills:1 key:01af032fa2
## Assumptions in Instrumental Variable Analysis 
In the previous question, Alan the almond farmer measured the effect of almond prices on rates of almond sales through instrumental variable analysis. Alan knew that almond prices were effected by the weather; therefore, Alan examined how weather patterns were associated with rates of almond sales, concluding that any correlation may be indicative of a causal relationship. Which of the following assumptions does Alan's model depend on?

a) Almond prices are effected by the weather 
b) The weather and rates almond sales are not both consequences of another factor 
c) The weather is not correlated with other factors (besides almond prices) that are consequential to rates of almond sales. 
d) The weather has no effect on the demand for almonds by consumers

*** =instructions
- a, c
- b, d
- a, b, c 
- a, b, c, d
*** =sct
```{r}
msg1 = "Almost! These are both assumptions of Alan's model, but there are more. Try again"
msg2 = "Not quite. b) is an important assumption of Alan's model, but d) is not. Try again."
msg3 = "Correct! a) is true because the instrument in any IV model must effect the independent variable of interest. b) and c) are true because IVs require that the relationship between an instrument and the dependent variable cannot be explained by any other factors but their causal relationships to the key independent variable. d) is false for the same reason that b) and c) are true; if the weather directly effects the rate of almond sales, then we cannot assume that the this relationship is mediated by the effect of the weather on almond sales prices."
msg4 = "Almost! At least one of the possible assumptions is false."
test_mc(correct = 3, feedback_msgs = c(msg1,msg2,msg3,msg4))
```


--- type:VideoExercise lang:r aspect_ratio:62.5 xp:50 skills:1 key:3ae8d65d96
## Some Instrumental Variables Terminology
*** =video_link
//player.vimeo.com/video/219565557


--- type:VideoExercise lang:r aspect_ratio:62.5 xp:50 skills:1 key:bf3c9abc64
## The Problem of Weak Instruments
*** =video_link
//player.vimeo.com/video/219559996


--- type:MultipleChoiceExercise lang:r xp:50 skills:1 key:02e185272f
## An Example of a Weak Instrument  
A public health specialist names Phoebe is interested in how a person's wealth (their assets minus their debts) might effect their health. Phoebe has longitudinal data on people's wealth and health, but she's having trouble determining whether wealth has a causal effect on health with traditional regression models. Phoebe's concern is that a person's health varies endogenously with their weath; a person's wealth might have a positive causal effect on their health, but a person's health could also have a positive causal effect on their wealth. 

To untangle this causal relationship, Phoebe decides to conduct an instrumental variable analysis of wealth's effect on health with inheritance as an exogenous instrument of wealth (that is, inheritance effects a person's wealth but does not have any direct or indirect relationship with a person's health other than through how it might affect wealth). However, Phoebe's analysis yields no statistically significant results. Phoebe also tests the relationship between inheritance and wealth, and finds that there is only a very weak correlation. Which of the following could this imply?    
  
  *** =instructions
- Inheritance has a direct causal effect on health.
- These results are uninformative about any potential causality between wealth and health.
- People who inherit money often feel guilty, leading to a decline in health.
- People are more likely to inherit money when they themselves have poor health. 

*** =sct
```{r}
msg1 = "Although this instrumental variable would be poor for this analysis (an instrument should not have a direct effect on the dependent variable), this is not an example of a 'weak' instrumental variable."
msg2 = "Correct! Only a small percentage of people ever inherit a substantial amount of money, and those who do tend to have better wealth to begin with. So despite our theories, the data we have might have very little statistical power on the relationship between wealth and health."
msg3 = "This answer is very similar to the first one. In this case, the problem is not that the instrument is 'weak' but that the instrument has a direct causal effect on health."
msg4 = "Although this instrumental variable would be poor for this analysis (an instrument should be randomly assigned), this is not an example of a 'weak' instrumental variable."

test_mc(correct = 2, feedback_msgs = c(msg1,msg2,msg3,msg4))
```


--- type:VideoExercise lang:r aspect_ratio:62.5 xp:50 skills:1 key:90f146a86a
## Where Do Instruments Come From?
*** =video_link
//player.vimeo.com/video/219560424


--- type:VideoExercise lang:r aspect_ratio:62.5 xp:50 skills:1 key:34850f663a
## Which Causal Effects Are We Actually Getting with Instrumental Variables?
*** =video_link
//player.vimeo.com/video/219560614


